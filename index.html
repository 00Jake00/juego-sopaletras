<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sopa de Letras - Amor y Amistad</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      background: #fff0f5;
      margin: 0;
      padding: 20px;
    }
    h1 {
      color: #d63384;
      text-align: center;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      width: 100%;
      max-width: 500px;
      aspect-ratio: 1 / 1;
      gap: 2px;
      margin: 20px 0;
      touch-action: none;
    }
    .cell {
      background-color: white;
      border: 1px solid #ccc;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      user-select: none;
      cursor: pointer;
      font-size: 1.2rem;
    }
    .cell.selected {
      background-color: #d63384;
      color: white;
    }
    .cell.found {
      background-color: #ffc0cb;
      color: white;
    }
    .panel {
      margin-top: 20px;
      background: #fff;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      max-width: 500px;
      text-align: center;
    }
    .word-list {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }
    .word {
      background: #f8d7da;
      padding: 5px 10px;
      border-radius: 5px;
      font-weight: bold;
    }
    .word.found {
      background: #c3e6cb;
    }
    .reflexion {
      margin-top: 15px;
      font-style: italic;
    }
  </style>
</head>
<body>
  <h1>Palabras que construyen Amor y Amistad</h1>

  <div class="grid" id="sopa"></div>

  <div class="panel">
    <div class="word-list" id="lista-palabras"></div>
    <div class="reflexion" id="reflexion"></div>
  </div>

  <script>
    const tam = 12;
    const grid = Array.from({ length: tam }, () => Array(tam).fill(""));
    const palabras = [
      { texto: "AMOR", reflexion: "El amor es más fuerte cuando no duele ni impone.", coords: [] },
      { texto: "AMISTAD", reflexion: "La amistad sana se construye con respeto y escucha.", coords: [] },
      { texto: "RESPETO", reflexion: "Amar no es controlar. Respetar es la base del buen trato.", coords: [] },
      { texto: "EMPATIA", reflexion: "Antes de juzgar, intenta ponerte en los zapatos del otro.", coords: [] }
    ];

    const direcciones = [
      [0, 1], [1, 0], [1, 1], [-1, 1],
      [0, -1], [-1, 0], [-1, -1], [1, -1]
    ];

    function puedeColocar(palabra, row, col, dx, dy) {
      for (let i = 0; i < palabra.length; i++) {
        const r = row + i * dy;
        const c = col + i * dx;
        if (r < 0 || r >= tam || c < 0 || c >= tam || (grid[r][c] && grid[r][c] !== palabra[i])) return false;
      }
      return true;
    }

    function colocarPalabra(p) {
      let placed = false;
      let intentos = 0;

      while (!placed && intentos < 100) {
        const dir = direcciones[Math.floor(Math.random() * direcciones.length)];
        const dx = dir[0];
        const dy = dir[1];
        const row = Math.floor(Math.random() * tam);
        const col = Math.floor(Math.random() * tam);

        if (puedeColocar(p.texto, row, col, dx, dy)) {
          const coords = [];
          for (let i = 0; i < p.texto.length; i++) {
            const r = row + i * dy;
            const c = col + i * dx;
            grid[r][c] = p.texto[i];
            coords.push(`${r}-${c}`);
          }
          p.coords = coords;
          placed = true;
        }
        intentos++;
      }
      if (!placed) console.warn(`No se pudo colocar la palabra: ${p.texto}`);
    }

    function rellenarLetras() {
      const letras = "ABCDEFGHIJKLMNÑOPQRSTUVWXYZ";
      for (let i = 0; i < tam; i++) {
        for (let j = 0; j < tam; j++) {
          if (!grid[i][j]) {
            grid[i][j] = letras[Math.floor(Math.random() * letras.length)];
          }
        }
      }
    }

    const sopa = document.getElementById("sopa");
    const lista = document.getElementById("lista-palabras");
    const reflexion = document.getElementById("reflexion");

    function renderSopa() {
      sopa.innerHTML = "";
      for (let i = 0; i < tam; i++) {
        for (let j = 0; j < tam; j++) {
          const div = document.createElement("div");
          div.className = "cell";
          div.id = `${i}-${j}`;
          div.textContent = grid[i][j];
          sopa.appendChild(div);
        }
      }
    }

    function mostrarPalabras() {
      lista.innerHTML = "";
      palabras.forEach(p => {
        const span = document.createElement("span");
        span.className = "word";
        span.id = `palabra-${p.texto}`;
        span.textContent = p.texto;
        lista.appendChild(span);
      });
    }

    let seleccion = [];
    let seleccionActiva = false;

    function iniciarEventos() {
      sopa.addEventListener("mousedown", empezarSeleccion);
      sopa.addEventListener("mousemove", arrastrarSeleccion);
      sopa.addEventListener("mouseup", finalizarSeleccion);
      sopa.addEventListener("touchstart", empezarSeleccionTouch, { passive: false });
      sopa.addEventListener("touchmove", arrastrarSeleccionTouch, { passive: false });
      sopa.addEventListener("touchend", finalizarSeleccion);
    }

    function empezarSeleccion(e) {
      seleccionActiva = true;
      seleccion = [];
      limpiarSeleccion();
      const target = e.target.closest(".cell");
      if (target) seleccionarCelda(target);
    }

    function arrastrarSeleccion(e) {
      if (!seleccionActiva) return;
      const target = e.target.closest(".cell");
      if (target && !seleccion.includes(target.id)) seleccionarCelda(target);
    }

    function empezarSeleccionTouch(e) {
      e.preventDefault();
      seleccionActiva = true;
      seleccion = [];
      limpiarSeleccion();
      const touch = document.elementFromPoint(e.touches[0].clientX, e.touches[0].clientY);
      if (touch && touch.classList.contains("cell")) seleccionarCelda(touch);
    }

    function arrastrarSeleccionTouch(e) {
      e.preventDefault();
      if (!seleccionActiva) return;
      const touch = document.elementFromPoint(e.touches[0].clientX, e.touches[0].clientY);
      if (touch && touch.classList.contains("cell") && !seleccion.includes(touch.id)) seleccionarCelda(touch);
    }

    function finalizarSeleccion() {
      seleccionActiva = false;
      const palabraActual = seleccion.map(id => document.getElementById(id).textContent).join("");
      const match = palabras.find(p => p.texto === palabraActual && p.coords.every((c, i) => seleccion[i] === c));
      if (match) {
        match.coords.forEach(id => {
          const cell = document.getElementById(id);
          cell.classList.remove("selected");
          cell.classList.add("found");
        });
        document.getElementById(`palabra-${match.texto}`).classList.add("found");
        reflexion.textContent = match.reflexion;
      } else {
        limpiarSeleccion();
        reflexion.textContent = "";
      }
      seleccion = [];
    }

    function seleccionarCelda(el) {
      el.classList.add("selected");
      seleccion.push(el.id);
    }

    function limpiarSeleccion() {
      document.querySelectorAll(".cell.selected").forEach(c => c.classList.remove("selected"));
    }

    palabras.forEach(p => colocarPalabra(p));
    rellenarLetras();
    renderSopa();
    mostrarPalabras();
    iniciarEventos();
  </script>
</body>
</html>