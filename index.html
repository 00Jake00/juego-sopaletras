<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sopa de Letras - Amor y Amistad</title>

  <!-- Comfortaa -->
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --magenta:#d63384;
      --chip-found:#c3e6cb;
      --chip-pending:#f8d7da;
      --bg:#fff0f5;
      --cell:#ffffff;
      --cell-border:#cccccc;
      --sel:#d63384;
      --sel-text:#ffffff;
      --found:#ffc0cb;
    }

    *{ box-sizing: border-box; }
    html, body { height: 100%; }
    body{
      margin:0; padding:20px;
      font-family: 'Comfortaa', system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: var(--bg);
      color:#111;
      display:flex; flex-direction:column; align-items:center; gap:16px;
      -webkit-user-select: none; user-select: none;
    }

    header{ text-align:center; max-width:900px }
    h1{
      margin:.25rem 0 .35rem;
      color: var(--magenta);           /* Título magenta */
      font-weight:700;
      font-size: clamp(22px, 4.6vw, 40px);
      line-height:1.15;
    }
    p.sub{
      margin:0;
      color:#111;                      /* Frase en negro */
      font-weight:600;
      font-size: clamp(14px, 2.8vw, 18px);
    }

    /* HUD */
    .hud{
      display:flex; gap:10px; flex-wrap:wrap; justify-content:center;
      font-size: clamp(12px, 2.6vw, 14px);
    }
    .badge{
      background:#fff; border:1px solid #eee;
      padding:6px 10px; border-radius:999px;
      box-shadow:0 6px 24px rgba(0,0,0,.06);
      font-weight:700;
    }

    /* Tablero */
    .grid{
      display:grid;
      grid-template-columns: repeat(18, 1fr); /* 18x18 */
      width: min(92vw, 700px);
      aspect-ratio: 1 / 1;
      gap: 2px;
      margin: 14px 0;
      touch-action: none; /* importante para iOS */
      -webkit-tap-highlight-color: transparent;
      background: transparent;
    }
    .cell{
      background: var(--cell);
      border: 1px solid var(--cell-border);
      display:flex; align-items:center; justify-content:center;
      font-weight: 700;
      font-size: clamp(.72rem, 1.1vw + .55rem, 1.15rem);
      line-height:1;
      cursor: pointer;
      transition: background .15s ease;
    }
    .cell.selected{ background: var(--sel); color: var(--sel-text); }
    .cell.found{ background: var(--found); color:#fff; }

    /* Panel */
    .panel{
      width: min(92vw, 700px);
      background:#fff;
      padding: 14px;
      border-radius: 12px;
      box-shadow: 0 6px 24px rgba(0,0,0,.08);
      text-align:center;
    }
    .word-list{
      display:flex; flex-wrap:wrap; gap:10px; justify-content:center;
      margin-bottom: 10px;
    }
    .word{
      background: var(--chip-pending);
      padding:6px 10px;
      border-radius: 999px;
      font-weight:700;
      font-size: clamp(12px, 2.6vw, 14px);
    }
    .word.found{ background: var(--chip-found); }
    .reflexion{ display:none; } /* ya no mostramos texto fijo abajo; ahora va en popup */

    @media (max-width: 420px){
      .grid{ gap: 1.5px; }
    }

    /* ===== Popup accesible ===== */
    .pop{
      position: fixed; inset: 0;
      background: rgba(0,0,0,.55);
      display: none;
      align-items: center; justify-content: center;
      z-index: 9999;
      padding: 16px;
      overscroll-behavior: contain;
    }
    .pop.show{ display:flex; }
    .pop-card{
      background:#fff; color:#111;
      width: min(92vw, 560px);
      border-radius: 16px;
      box-shadow: 0 16px 50px rgba(0,0,0,.25);
      padding: 18px;
      max-height: 80vh; overflow:auto;
      animation: popIn .18s ease-out;
    }
    @keyframes popIn{ from{ transform: scale(.96); opacity: .0 } to{ transform: scale(1); opacity:1 } }
    .pop-head{
      display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:8px;
    }
    .pop-title{
      margin:0; font-size: clamp(18px, 3.8vw, 22px); font-weight:700; color: var(--magenta);
    }
    .pop-msg{
      margin: 6px 0 0; font-size: clamp(14px, 2.8vw, 16px); line-height:1.45;
    }
    .pop-close{
      appearance:none; border:0; background:#111; color:#fff;
      padding:8px 12px; font-weight:700; border-radius:10px; cursor:pointer;
    }
    .pop-overlay-dismiss{ position:absolute; inset:0; }
    @media (prefers-reduced-motion: reduce){
      .pop-card{ animation: none; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Palabras que construyen Amor y Amistad</h1>
    <p class="sub">Encuentra las parejas: palabra + mensaje que construyen vínculos sanos.</p>
  </header>

  <div class="hud" role="status" aria-live="polite">
    <span class="badge">Encontradas: <strong id="foundCount">0</strong>/11</span>
  </div>

  <div class="grid" id="sopa"></div>

  <div class="panel">
    <div class="word-list" id="lista-palabras"></div>
    <div class="reflexion" id="reflexion"></div>
  </div>

  <!-- ===== Popup ===== -->
  <div class="pop" id="pop" role="dialog" aria-modal="true" aria-labelledby="popTitle" aria-describedby="popMsg">
    <div class="pop-overlay-dismiss" data-close="1"></div>
    <div class="pop-card">
      <div class="pop-head">
        <h2 class="pop-title" id="popTitle">¡Palabra encontrada!</h2>
        <button class="pop-close" type="button" id="popClose">Cerrar</button>
      </div>
      <p class="pop-msg" id="popMsg"></p>
    </div>
  </div>

  <script>
    /* ====== Configuración ====== */
    const TAM = 18; // 18x18 para palabras largas
    const grid = Array.from({ length: TAM }, () => Array(TAM).fill(""));

    // Lista de palabras (sin tildes) + reflexiones EXACTAS
    const PALABRAS = [
      { texto: "CONVIVENCIA", reflexion: "La mejor celebración es la que se vive pacíficamente.", coords: [] },
      { texto: "AMISTAD", reflexion: "Compartir con respeto y cuidado fortalece la amistad.", coords: [] },
      { texto: "CORRESPONSABILIDAD", reflexion: "El bienestar se construye cuidando de nosotros y de los demás.", coords: [] },
      { texto: "UNION", reflexion: "Celebremos en paz: sin violencia, sin drama, solo unión.", coords: [] },
      { texto: "RESPETO", reflexion: "Si hay golpe y agresión, se daña la celebración.", coords: [] },
      { texto: "SOLIDARIDAD", reflexion: "Ayudar y acompañar también es celebrar el amor y la amistad.", coords: [] },
      { texto: "ALEGRIA", reflexion: "Celebremos con alegría, responsabilidad y empatía en cada decisión.", coords: [] },
      { texto: "EMOCION", reflexion: "Gestiona tus emociones: evita las riñas, que el amor sea la celebración.", coords: [] },
      { texto: "EMPATIA", reflexion: "Celebrar con empatía: comprender y cuidar hace la fiesta más bonita.", coords: [] },
      { texto: "AUTORREGULACION", reflexion: "Controla tus actos para que la celebración termine sin nada que lamentar.", coords: [] },
      { texto: "AMOR", reflexion: "Cuidar cómo celebramos es cuidar la vida de quienes amamos.", coords: [] }
    ];

    // 8 direcciones (incluye diagonales e inversas)
    const DIRECCIONES = [
      [ 0,  1], [ 1,  0], [ 1,  1], [-1,  1],
      [ 0, -1], [-1,  0], [-1, -1], [ 1, -1]
    ];

    // Letras aleatorias (incluye Ñ)
    const ALFABETO = "ABCDEFGHIJKLMNÑOPQRSTUVWXYZ";

    /* ====== Utilidades ====== */
    const $  = (sel, ctx=document) => ctx.querySelector(sel);

    function puedeColocar(palabra, row, col, dx, dy) {
      for (let i = 0; i < palabra.length; i++) {
        const r = row + i * dy;
        const c = col + i * dx;
        if (r < 0 || r >= TAM || c < 0 || c >= TAM) return false;
        if (grid[r][c] && grid[r][c] !== palabra[i]) return false;
      }
      return true;
    }

    function colocarPalabra(p) {
      let placed = false;
      let intentos = 0;
      const MAX_INTENTOS = 800;

      while (!placed && intentos < MAX_INTENTOS) {
        const [dx, dy] = DIRECCIONES[Math.floor(Math.random() * DIRECCIONES.length)];
        const row = Math.floor(Math.random() * TAM);
        const col = Math.floor(Math.random() * TAM);

        if (puedeColocar(p.texto, row, col, dx, dy)) {
          const coords = [];
          for (let i = 0; i < p.texto.length; i++) {
            const r = row + i * dy;
            const c = col + i * dx;
            grid[r][c] = p.texto[i];
            coords.push(`${r}-${c}`);
          }
          p.coords = coords;
          placed = true;
        }
        intentos++;
      }
      if (!placed) console.warn(`No se pudo colocar la palabra: ${p.texto}`);
    }

    function rellenarLetras() {
      for (let i = 0; i < TAM; i++) {
        for (let j = 0; j < TAM; j++) {
          if (!grid[i][j]) {
            grid[i][j] = ALFABETO[Math.floor(Math.random() * ALFABETO.length)];
          }
        }
      }
    }

    const sopa = $("#sopa");
    const lista = $("#lista-palabras");
    const foundCountEl = $("#foundCount");

    function renderSopa() {
      sopa.innerHTML = "";
      for (let i = 0; i < TAM; i++) {
        for (let j = 0; j < TAM; j++) {
          const div = document.createElement("div");
          div.className = "cell";
          div.id = `${i}-${j}`;
          div.textContent = grid[i][j];
          sopa.appendChild(div);
        }
      }
    }

    function mostrarPalabras() {
      lista.innerHTML = "";
      PALABRAS.forEach(p => {
        const span = document.createElement("span");
        span.className = "word";
        span.id = `palabra-${p.texto}`;
        span.textContent = p.texto;
        lista.appendChild(span);
      });
    }

    /* ====== Popup ====== */
    const pop = $("#pop");
    const popMsg = $("#popMsg");
    const popClose = $("#popClose");

    function showPopup(msg){
      popMsg.textContent = msg;
      pop.classList.add("show");

      // Auto-cierre (puedes desactivar comentando estas 2 líneas)
      clearTimeout(showPopup._t);
      showPopup._t = setTimeout(hidePopup, 2200); // <-- cambia el tiempo o comenta para quitar autocierre

      // Enfocar botón para accesibilidad
      popClose.focus();
      document.addEventListener("keydown", onEscOnce, { once:true });
    }
    function hidePopup(){
      pop.classList.remove("show");
    }
    function onEscOnce(e){
      if(e.key === "Escape") hidePopup();
    }
    pop.addEventListener("click", (e)=>{ if(e.target.dataset.close) hidePopup(); });
    popClose.addEventListener("click", hidePopup);

    /* ====== Selección con ratón/touch ====== */
    let seleccion = [];
    let seleccionActiva = false;
    let totalEncontradas = 0;

    function seleccionarCelda(el) {
      if (!el || !el.classList.contains("cell")) return;
      const id = el.id;
      if (seleccion[seleccion.length-1] === id) return; // evitar repetir última
      el.classList.add("selected");
      seleccion.push(id);
    }

    function limpiarSeleccion() {
      document.querySelectorAll(".cell.selected").forEach(c => c.classList.remove("selected"));
      seleccion = [];
    }

    function marcarEncontrada(pal) {
      pal.coords.forEach(id => {
        const cell = document.getElementById(id);
        cell.classList.remove("selected");
        cell.classList.add("found");
      });
      const chip = document.getElementById(`palabra-${pal.texto}`);
      chip.classList.add("found");

      // Mostrar reflexión en popup
      showPopup(pal.reflexion);

      totalEncontradas++;
      foundCountEl.textContent = totalEncontradas;
    }

    function verificarSeleccion() {
      if (seleccion.length < 2) { limpiarSeleccion(); return; }

      const textoSel = seleccion.map(id => document.getElementById(id).textContent).join("");

      const hit = PALABRAS.find(p => {
        if (seleccion.length !== p.coords.length) return false;
        const coincideTexto = (textoSel === p.texto);
        const coincideCoords = p.coords.every((c, i) => c === seleccion[i]);
        return coincideTexto && coincideCoords;
      });

      if (hit) {
        marcarEncontrada(hit);
      } else {
        // Intento inverso
        const textoSelInv = [...textoSel].reverse().join("");
        const coordsInv = [...seleccion].reverse();
        const hitInv = PALABRAS.find(p => {
          if (seleccion.length !== p.coords.length) return false;
          const coincideTexto = (textoSelInv === p.texto);
          const coincideCoords = p.coords.every((c, i) => c === coordsInv[i]);
          return coincideTexto && coincideCoords;
        });
        if (hitInv) {
          marcarEncontrada(hitInv);
        }
      }

      limpiarSeleccion();
    }

    function empezarSeleccion(e) {
      seleccionActiva = true;
      limpiarSeleccion();
      const target = e.target.closest(".cell");
      seleccionarCelda(target);
    }
    function arrastrarSeleccion(e) {
      if (!seleccionActiva) return;
      const target = e.target.closest(".cell");
      if (target) seleccionarCelda(target);
    }
    function finalizarSeleccion() {
      seleccionActiva = false;
      verificarSeleccion();
    }

    // TOUCH (iPhone friendly)
    function empezarSeleccionTouch(e) {
      e.preventDefault();
      seleccionActiva = true;
      limpiarSeleccion();
      const touch = document.elementFromPoint(e.touches[0].clientX, e.touches[0].clientY);
      seleccionarCelda(touch);
    }
    function arrastrarSeleccionTouch(e) {
      e.preventDefault();
      if (!seleccionActiva) return;
      const touch = document.elementFromPoint(e.touches[0].clientX, e.touches[0].clientY);
      seleccionarCelda(touch);
    }

    function iniciarEventos() {
      sopa.addEventListener("mousedown", empezarSeleccion);
      sopa.addEventListener("mousemove", arrastrarSeleccion);
      document.addEventListener("mouseup", finalizarSeleccion);

      sopa.addEventListener("touchstart", empezarSeleccionTouch, { passive: false });
      sopa.addEventListener("touchmove", arrastrarSeleccionTouch, { passive: false });
      sopa.addEventListener("touchend", finalizarSeleccion);
      sopa.addEventListener("touchcancel", finalizarSeleccion);
    }

    /* ====== Init ====== */
    PALABRAS.forEach(p => colocarPalabra(p));
    rellenarLetras();
    renderSopa();
    mostrarPalabras();
    iniciarEventos();
  </script>
</body>
</html>


