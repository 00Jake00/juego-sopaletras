<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sopa de Letras - Amor y Amistad</title>

  <!-- Comfortaa -->
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --primary:#d63384;   /* Magenta */
      --accent:#ffc0cb;
      --shadow:0 8px 30px rgba(0,0,0,.08);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0; padding:16px;
      font-family: "Comfortaa", system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      color:#222;
      display:flex; flex-direction:column; align-items:center; gap:12px;
      background: transparent;
    }

    /* Fondo full H/V */
    body::before{
      content:"";
      position: fixed; inset: 0;
      z-index: -1;
      background: url("https://raw.githubusercontent.com/00Jake00/juego-sopaletras/main/DPCC_Campan%CC%83a%20Amor%20y%20Amistad_FondoJuegos_Fondo-H.jpg") center/cover no-repeat;
    }
    @media (max-width: 575.98px){
      body::before{
        background-image: url("https://raw.githubusercontent.com/00Jake00/juego-sopaletras/main/DPCC_Campan%CC%83a%20Amor%20y%20Amistad_FondoJuegos_Fondo-V.jpg");
      }
    }

    /* Logos (scroll) */
    .logo-row{ width:100%; max-width:1000px; margin:0 auto; }
    .corner{
      position:static !important;
      display:inline-block;
      width: clamp(68px, 22vw, 96px) !important;
      height:auto; margin:6px 0;
      pointer-events:none;
    }
    .logo-left{  float:left; }
    .logo-right{ float:right; }
    header{ clear:both; margin-top:6px; }

    @media (min-width: 992px){
      .corner{ width: clamp(110px, 12vw, 160px) !important; margin:10px 0; }
      header{ margin-top:8px; }
    }

    /* Encabezado */
    header{ max-width:960px; width:100%; text-align:center }
    h1{ margin:.25rem 0; color:var(--primary); font-size: clamp(22px, 4.8vw, 34px); text-shadow:none; }
    p.sub{ margin:0; opacity:.95; color:#111; }

    /* Tablero (más grande en desktop) */
    .grid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      width: 100%;
      max-width: 680px;    /* <- más grande */
      aspect-ratio: 1 / 1;
      gap: 2px;
      margin: 16px 0;
      touch-action: none;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
      -webkit-user-select: none;
    }
    .cell{
      background-color:#fff;
      border:1px solid #ccc;
      display:flex; justify-content:center; align-items:center;
      font-weight:700;
      cursor:pointer;
      font-size: clamp(1.05rem, 1.2vw, 1.35rem);  /* un pelín más grande */
      line-height:1;
    }
    .cell.selected{ background-color:#d63384; color:#fff; }
    .cell.found{ background-color:#ffc0cb; color:#fff; }

    /* Panel */
    .panel{
      background: rgba(255,255,255,.92);
      padding: 12px 14px;
      border-radius:12px;
      box-shadow: var(--shadow);
      max-width: 680px;
      text-align:center;
    }
    .word-list{ display:flex; flex-wrap:wrap; justify-content:center; gap:8px; }
    .word{
      background:#f8d7da; padding:6px 10px; border-radius:999px; font-weight:700; font-size:.95rem;
    }
    .word.found{ background:#c3e6cb; }

    /* Modal reflexión */
    .modal{
      position: fixed; inset: 0;
      background: rgba(0,0,0,.56);
      display:none; align-items:center; justify-content:center;
      padding: 16px;
      z-index: 9999;
    }
    .modal.show{ display:flex; }
    .modal-card{
      background:#fff; color:#111; border-radius:16px;
      box-shadow: var(--shadow);
      max-width: 560px; width:100%;
      padding: 18px 16px 14px;
      text-align:center; position: relative;
    }
    .modal-title{ margin:0 0 6px; color:#d63384; font-weight:800; }
    .modal-body{ margin:0; font-size:1rem; line-height:1.4; }
    .modal-close{
      position:absolute; top:8px; right:8px;
      border:0; background:#fff; color:#111; font-size:20px;
      width:32px; height:32px; border-radius:50%; cursor:pointer;
      box-shadow:0 0 0 1px rgba(0,0,0,.12);
    }
    .modal-close:focus-visible{ outline:3px solid #0005; outline-offset:2px; }
  </style>
</head>
<body>

  <!-- Logos -->
  <div class="logo-row">
    <img class="corner logo-left"
         src="https://raw.githubusercontent.com/00Jake00/juego-sopaletras/main/LOGO.png"
         alt="Logo campaña" loading="lazy">
    <img class="corner logo-right"
         src="https://raw.githubusercontent.com/00Jake00/juego-sopaletras/main/BTA.png"
         alt="Logo Bogotá" loading="lazy">
  </div>

  <header>
    <h1>Palabras que construyen Amor y Amistad</h1>
    <p class="sub">Encuentra las parejas: palabra + mensaje que construyen vínculos sanos.</p>
  </header>

  <div class="grid" id="sopa"></div>

  <div class="panel">
    <div class="word-list" id="lista-palabras"></div>
  </div>

  <!-- Modal reflexión -->
  <div class="modal" id="modal">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-describedby="modalBody">
      <button class="modal-close" id="modalClose" aria-label="Cerrar">×</button>
      <h3 class="modal-title" id="modalTitle">¡Bien!</h3>
      <p class="modal-body" id="modalBody">Reflexión…</p>
    </div>
  </div>

  <script>
    const tam = 12;
    const grid = Array.from({ length: tam }, () => Array(tam).fill(""));

    // 11 palabras + reflexiones
    const palabras = [
      { texto: "CONVIVENCIA", reflexion: "La mejor celebración es la que se vive pacíficamente.", coords: [] },
      { texto: "AMISTAD", reflexion: "Compartir con respeto y cuidado fortalece la amistad.", coords: [] },
      { texto: "CORRESPONSABILIDAD", reflexion: "El bienestar se construye cuidando de nosotros y de los demás.", coords: [] },
      { texto: "UNION", reflexion: "Celebremos en paz: sin violencia, sin drama, solo unión.", coords: [] },
      { texto: "RESPETO", reflexion: "Si hay golpe y agresión, se daña la celebración.", coords: [] },
      { texto: "SOLIDARIDAD", reflexion: "Ayudar y acompañar también es celebrar el amor y la amistad.", coords: [] },
      { texto: "ALEGRIA", reflexion: "Celebremos con alegría, responsabilidad y empatía en cada decisión.", coords: [] },
      { texto: "EMOCION", reflexion: "Gestiona tus emociones: evita las riñas, que el amor sea la celebración.", coords: [] },
      { texto: "EMPATIA", reflexion: "Celebrar con empatía: comprender y cuidar hace la fiesta más bonita.", coords: [] },
      { texto: "AUTORREGULACION", reflexion: "Controla tus actos para que la celebración termine sin nada que lamentar.", coords: [] },
      { texto: "AMOR", reflexion: "Cuidar cómo celebramos es cuidar la vida de quienes amamos.", coords: [] }
    ];

    const direcciones = [
      [0, 1], [1, 0], [1, 1], [-1, 1],
      [0, -1], [-1, 0], [-1, -1], [1, -1]
    ];

    function puedeColocar(palabra, row, col, dx, dy) {
      for (let i = 0; i < palabra.length; i++) {
        const r = row + i * dy;
        const c = col + i * dx;
        if (r < 0 || r >= tam || c < 0 || c >= tam || (grid[r][c] && grid[r][c] !== palabra[i])) return false;
      }
      return true;
    }

    function colocarPalabra(p) {
      let placed = false;
      let intentos = 0;
      while (!placed && intentos < 200) {
        const dir = direcciones[Math.floor(Math.random() * direcciones.length)];
        const dx = dir[0], dy = dir[1];
        const row = Math.floor(Math.random() * tam);
        const col = Math.floor(Math.random() * tam);
        if (puedeColocar(p.texto, row, col, dx, dy)) {
          const coords = [];
          for (let i = 0; i < p.texto.length; i++) {
            const r = row + i * dy;
            const c = col + i * dx;
            grid[r][c] = p.texto[i];
            coords.push(`${r}-${c}`);
          }
          p.coords = coords;
          placed = true;
        }
        intentos++;
      }
      if (!placed) console.warn(`No se pudo colocar la palabra: ${p.texto}`);
    }

    function rellenarLetras() {
      const letras = "ABCDEFGHIJKLMNÑOPQRSTUVWXYZ";
      for (let i = 0; i < tam; i++) {
        for (let j = 0; j < tam; j++) {
          if (!grid[i][j]) grid[i][j] = letras[Math.floor(Math.random() * letras.length)];
        }
      }
    }

    const sopa  = document.getElementById("sopa");
    const lista = document.getElementById("lista-palabras");

    function renderSopa() {
      sopa.innerHTML = "";
      for (let i = 0; i < tam; i++) {
        for (let j = 0; j < tam; j++) {
          const div = document.createElement("div");
          div.className = "cell";
          div.id = `${i}-${j}`;
          div.textContent = grid[i][j];
          sopa.appendChild(div);
        }
      }
    }

    function mostrarPalabras() {
      lista.innerHTML = "";
      palabras.forEach(p => {
        const span = document.createElement("span");
        span.className = "word";
        span.id = `palabra-${p.texto}`;
        span.textContent = p.texto;
        lista.appendChild(span);
      });
    }

    // ===== Selección con “imán” (snap a línea) =====
    let seleccion = [];
    let seleccionActiva = false;

    function idToRC(id){ const [r,c]=id.split('-').map(Number); return {r,c}; }
    function rcToId(r,c){ return `${r}-${c}`; }
    function sign(n){ return n===0?0:(n>0?1:-1); }

    // Devuelve la línea “enderezada” entre primer y último punto, en la dirección más probable (8 direcciones)
    function snapLine(ids){
      if(ids.length<2) return ids;
      const start = idToRC(ids[0]);
      const end   = idToRC(ids[ids.length-1]);
      let dr = end.r - start.r;
      let dc = end.c - start.c;

      // Elegir dirección dominante (horizontal, vertical o diagonal)
      const adr = Math.abs(dr), adc = Math.abs(dc);
      let stepR=0, stepC=0, len=0;

      if(adr === adc && adr!==0){
        // diagonal perfecta
        stepR = sign(dr); stepC = sign(dc); len = adr;
      }else if(adc > adr){
        // más horizontal
        stepR = 0; stepC = sign(dc); len = adc;
      }else if(adr > adc){
        // más vertical
        stepR = sign(dr); stepC = 0; len = adr;
      }else{
        // mismo punto
        return [ids[0]];
      }

      const line = [];
      for(let i=0;i<=len;i++){
        const r = start.r + i*stepR;
        const c = start.c + i*stepC;
        if(r>=0 && r<tam && c>=0 && c<tam) line.push(rcToId(r,c));
      }
      return line;
    }

    function iniciarEventos() {
      sopa.addEventListener("mousedown", empezarSeleccion);
      sopa.addEventListener("mousemove", arrastrarSeleccion);
      sopa.addEventListener("mouseup", finalizarSeleccion);
      sopa.addEventListener("mouseleave", ()=> seleccionActiva=false);

      sopa.addEventListener("touchstart", empezarSeleccionTouch, { passive: false });
      sopa.addEventListener("touchmove", arrastrarSeleccionTouch, { passive: false });
      sopa.addEventListener("touchend", finalizarSeleccion);
    }

    function empezarSeleccion(e) {
      seleccionActiva = true;
      seleccion = [];
      limpiarSeleccion();
      const target = e.target.closest(".cell");
      if (target) seleccionarCelda(target);
    }

    function arrastrarSeleccion(e) {
      if (!seleccionActiva) return;
      const target = e.target.closest(".cell");
      if (target && !seleccion.includes(target.id)) seleccionarCelda(target);
    }

    function empezarSeleccionTouch(e) {
      e.preventDefault();
      seleccionActiva = true;
      seleccion = [];
      limpiarSeleccion();
      const t = e.touches[0];
      const touch = document.elementFromPoint(t.clientX, t.clientY);
      if (touch && touch.classList.contains("cell")) seleccionarCelda(touch);
    }

    function arrastrarSeleccionTouch(e) {
      e.preventDefault();
      if (!seleccionActiva) return;
      const t = e.touches[0];
      const touch = document.elementFromPoint(t.clientX, t.clientY);
      if (touch && touch.classList.contains("cell") && !seleccion.includes(touch.id)) seleccionarCelda(touch);
    }

    function finalizarSeleccion() {
      if(!seleccion.length) return;
      seleccionActiva = false;

      // “Imán”: enderezar a línea probable
      const snapped = snapLine(seleccion);

      const wordFwd = snapped.map(id => document.getElementById(id).textContent).join("");
      const wordRev = wordFwd.split("").reverse().join("");

      const match = palabras.find(p =>
        (p.texto === wordFwd && p.coords.length===snapped.length && p.coords.every((c,i)=> snapped[i]===c)) ||
        (p.texto === wordRev && p.coords.length===snapped.length && p.coords.slice().reverse().every((c,i)=> snapped[i]===c))
      );

      if (match) {
        match.coords.forEach(id => {
          const cell = document.getElementById(id);
          cell.classList.remove("selected");
          cell.classList.add("found");
        });
        document.getElementById(`palabra-${match.texto}`).classList.add("found");
        abrirModal(match.texto, match.reflexion);
      } else {
        limpiarSeleccion();
      }
      seleccion = [];
    }

    function seleccionarCelda(el) {
      el.classList.add("selected");
      seleccion.push(el.id);
    }

    function limpiarSeleccion() {
      document.querySelectorAll(".cell.selected").forEach(c => c.classList.remove("selected"));
    }

    // Modal
    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody  = document.getElementById('modalBody');
    const modalClose = document.getElementById('modalClose');
    function abrirModal(titulo, texto){ modalTitle.textContent=titulo; modalBody.textContent=texto; modal.classList.add('show'); }
    function cerrarModal(){ modal.classList.remove('show'); }
    modalClose.addEventListener('click', cerrarModal);
    modal.addEventListener('click', (e)=>{ if(e.target === modal) cerrarModal(); });
    document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape' && modal.classList.contains('show')) cerrarModal(); });

    // Init
    palabras.forEach(p => colocarPalabra(p));
    rellenarLetras();
    renderSopa();
    mostrarPalabras();
    iniciarEventos();
  </script>
</body>
</html>


