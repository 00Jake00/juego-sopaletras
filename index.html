<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sopa de Letras - Amor y Amistad</title>

  <!-- Comfortaa -->
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --magenta:#d63384;
      --chip-found:#c3e6cb;
      --chip-pending:#f8d7da;
      --bg:#fff0f5;
      --cell:#ffffff;
      --cell-border:#cccccc;
      --sel:#d63384;
      --sel-text:#ffffff;
      --found:#ffc0cb;

      --bg-desktop: url("https://raw.githubusercontent.com/00Jake00/juego-sopaletras/main/DPCC_Campan%CC%83a%20Amor%20y%20Amistad_FondoJuegos_Fondo-H.jpg");
      --bg-mobile:  url("https://raw.githubusercontent.com/00Jake00/juego-sopaletras/main/DPCC_Campan%CC%83a%20Amor%20y%20Amistad_FondoJuegos_Fondo-V.jpg");
    }

    *{ box-sizing: border-box; }
    html, body { height: 100%; }
    body{
      margin:0; padding:20px;
      font-family: 'Comfortaa', system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:#111;
      display:flex; flex-direction:column; align-items:center; gap:16px;
      -webkit-user-select: none; user-select: none;
      position: relative;
      overflow-x: hidden;
      background:#000;
    }

    body::before{
      content:""; position: fixed; inset: 0; z-index: -1;
      background-image: var(--bg-desktop);
      background-size: cover; background-position: center; background-repeat: no-repeat;
      background-attachment: fixed;
    }
    @media (max-width: 575.98px){
      body::before{ background-image: var(--bg-mobile); background-attachment: scroll; }
    }

    /* Contenedor principal para gestionar el layout */
    .main-container {
      position: relative;
      width: 100%;
      max-width: 1200px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* Logos - posición fija en desktop, relativa en móviles */
    .corner{
      position: fixed; 
      top: 10px; 
      width: clamp(70px, 10vw, 120px);
      height: auto; 
      z-index: 50; 
      pointer-events: none; 
      user-select: none;
    }
    .logo-left{ left: 10px; }
    .logo-right{ right: 10px; }
    
    @media (min-width: 992px){
      .corner{ top: 16px; width: clamp(110px, 12vw, 160px); }
      .logo-left{ left:16px; } .logo-right{ right:16px; }
    }
    
    /* En móviles, cambiar a posición absoluta dentro del contenedor */
    @media (max-width: 991.98px) {
      .corner {
        position: absolute;
        top: 0;
        width: 70px;
      }
      .logo-left { left: 0; }
      .logo-right { right: 0; }
    }
    
    /* Ajustar header para no superponerse con logos en móviles */
    header{ 
      text-align:center; 
      max-width:900px; 
      background: rgba(255,255,255,.82); 
      padding: 8px 12px; 
      border-radius: 12px; 
      margin-top: 80px; /* Espacio para los logos en móviles */
      z-index: 10;
      position: relative;
    }
    
    @media (min-width: 992px) {
      header {
        margin-top: 0; /* Resetear en desktop */
      }
    }

    h1{ margin:.25rem 0 .35rem; color: var(--magenta); font-weight:700; font-size: clamp(22px, 4.6vw, 40px); line-height:1.15; }
    p.sub{ margin:0; color:#111; font-weight:600; font-size: clamp(14px, 2.8vw, 18px); }

    .hud{ display:flex; gap:10px; flex-wrap:wrap; justify-content:center; font-size: clamp(12px, 2.6vw, 14px); }
    .badge{
      background: rgba(255,255,255,.9); border:1px solid #eee;
      padding:6px 10px; border-radius:999px; box-shadow:0 6px 24px rgba(0,0,0,.06);
      font-weight:700; backdrop-filter: blur(2px);
    }

    .grid{
      display:grid; grid-template-columns: repeat(18, 1fr);
      width: min(92vw, 700px); aspect-ratio: 1 / 1; gap: 2px; margin: 14px 0;
      touch-action: none; -webkit-tap-highlight-color: transparent;
      background: rgba(255,255,255,.85); border-radius: 12px; padding: 6px;
      box-shadow: 0 10px 30px rgba(0,0,0,.12); backdrop-filter: blur(2px);
    }
    .cell{
      background: var(--cell); border: 1px solid var(--cell-border);
      display:flex; align-items:center; justify-content:center;
      font-weight:700; font-size: clamp(.72rem, 1.1vw + .55rem, 1.15rem);
      line-height:1; cursor: pointer; transition: background .15s ease; border-radius: 6px;
    }
    .cell.selected{ background: var(--sel); color: var(--sel-text); }
    .cell.found{ background: var(--found); color:#fff; }

    .panel{
      width: min(92vw, 700px); background: rgba(255,255,255,.9);
      padding: 14px; border-radius: 12px; box-shadow: 0 6px 24px rgba(0,0,0,.08);
      text-align:center; backdrop-filter: blur(2px);
    }
    .word-list{ display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin-bottom: 10px; }
    .word{ background: var(--chip-pending); padding:6px 10px; border-radius: 999px; font-weight:700; font-size: clamp(12px, 2.6vw, 14px); }
    .word.found{ background: var(--chip-found); }

    @media (max-width: 420px){
      .grid{ gap: 1.5px; padding: 4px; }
      .corner {
        width: 60px; /* Reducir un poco más en móviles muy pequeños */
      }
      header {
        margin-top: 70px; /* Ajustar según el nuevo tamaño */
      }
    }

    /* Popup */
    .pop{ position: fixed; inset: 0; background: rgba(0,0,0,.55); display: none; align-items: center; justify-content: center; z-index: 9999; padding: 16px; }
    .pop.show{ display:flex; }
    .pop-card{
      background:#fff; color:#111; width: min(92vw, 560px);
      border-radius: 16px; box-shadow: 0 16px 50px rgba(0,0,0,.25); padding: 18px;
      max-height: 80vh; overflow:auto; animation: popIn .18s ease-out;
    }
    @keyframes popIn{ from{ transform: scale(.96); opacity: .0 } to{ transform: scale(1); opacity:1 } }
    .pop-head{ display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; }
    .pop-word{ font-size: clamp(20px, 4.5vw, 28px); font-weight:700; color: var(--magenta); margin:0; }
    .pop-msg{ margin: 6px 0 0; font-size: clamp(14px, 2.8vw, 16px); line-height:1.45; }
    .pop-close{ appearance:none; border:0; background:#111; color:#fff; padding:8px 12px; font-weight:700; border-radius:10px; cursor:pointer; }
    .pop-overlay-dismiss{ position:absolute; inset:0; }
	

  </style>
</head>
<body>
  <div class="main-container">
    <img class="corner logo-left"  src="https://raw.githubusercontent.com/00Jake00/juego-sopaletras/main/LOGO.png" alt="" aria-hidden="true">
    <img class="corner logo-right" src="https://raw.githubusercontent.com/00Jake00/juego-sopaletras/main/BTA.png"  alt="" aria-hidden="true">

    <header>
      <h1>Palabras que construyen Amor y Amistad</h1>
      <p class="sub">Encuentra las parejas: palabra + mensaje que construyen vínculos sanos.</p>
    </header>

    <div class="hud" role="status" aria-live="polite">
      <span class="badge">Encontradas: <strong id="foundCount">0</strong>/11</span>
    </div>

    <div class="grid" id="sopa"></div>

    <div class="panel">
      <div class="word-list" id="lista-palabras"></div>
    </div>
  </div>

  <!-- Popup -->
  <div class="pop" id="pop" role="dialog" aria-modal="true">
    <div class="pop-overlay-dismiss" data-close="1"></div>
    <div class="pop-card">
      <div class="pop-head">
        <h2 class="pop-word" id="popWord">Palabra</h2>
        <button class="pop-close" type="button" id="popClose">X</button>
      </div>
      <p class="pop-msg" id="popMsg"></p>
    </div>
  </div>

  <script>
    const TAM = 18;
    const grid = Array.from({ length: TAM }, () => Array(TAM).fill(""));

    const PALABRAS = [
      { texto: "CONVIVENCIA", reflexion: "La mejor celebración es la que se vive pacíficamente.", coords: [] },
      { texto: "AMISTAD", reflexion: "Compartir con respeto y cuidado fortalece la amistad.", coords: [] },
      { texto: "CORRESPONSABILIDAD", reflexion: "El bienestar se construye cuidando de nosotros y de los demás.", coords: [] },
      { texto: "UNION", reflexion: "Celebremos en paz: sin violencia, sin drama, solo unión.", coords: [] },
      { texto: "RESPETO", reflexion: "Si hay golpe y agresión, se daña la celebración.", coords: [] },
      { texto: "SOLIDARIDAD", reflexion: "Ayudar y acompañar también es celebrar el amor y la amistad.", coords: [] },
      { texto: "ALEGRIA", reflexion: "Celebremos con alegría, responsabilidad y empatía en cada decisión.", coords: [] },
      { texto: "EMOCION", reflexion: "Gestiona tus emociones: evita las riñas, que el amor sea la celebración.", coords: [] },
      { texto: "EMPATIA", reflexion: "Celebrar con empatía: comprender y cuidar hace la fiesta más bonita.", coords: [] },
      { texto: "AUTORREGULACION", reflexion: "Controla tus actos para que la celebración termine sin nada que lamentar.", coords: [] },
      { texto: "AMOR", reflexion: "Cuidar cómo celebramos es cuidar la vida de quienes amamos.", coords: [] }
    ];

    const DIRECCIONES = [
      [0,1],[1,0],[1,1],[-1,1],
      [0,-1],[-1,0],[-1,-1],[1,-1]
    ];
    const ALFABETO = "ABCDEFGHIJKLMNÑOPQRSTUVWXYZ";

    const $ = (sel, ctx=document) => ctx.querySelector(sel);

    function puedeColocar(palabra,row,col,dx,dy){
      for(let i=0;i<palabra.length;i++){
        const r=row+i*dy,c=col+i*dx;
        if(r<0||r>=TAM||c<0||c>=TAM|| (grid[r][c] && grid[r][c]!==palabra[i])) return false;
      }
      return true;
    }
    function colocarPalabra(p){
      let placed=false,int=0;
      while(!placed&&int<1500){
        const [dx,dy]=DIRECCIONES[Math.floor(Math.random()*DIRECCIONES.length)];
        const row=Math.floor(Math.random()*TAM), col=Math.floor(Math.random()*TAM);
        if(puedeColocar(p.texto,row,col,dx,dy)){
          const coords=[];
          for(let i=0;i<p.texto.length;i++){
            const r=row+i*dy,c=col+i*dx;
            grid[r][c]=p.texto[i]; coords.push(`${r}-${c}`);
          }
          p.coords=coords; placed=true;
          console.log(`Colocada: ${p.texto} en (${row},${col}) dirección [${dx},${dy}]`);
        }
        int++;
      }
      if(!placed) console.warn("No se pudo colocar:", p.texto);
    }
    function rellenarLetras(){
      for(let i=0;i<TAM;i++){
        for(let j=0;j<TAM;j++){
          if(!grid[i][j]){
            grid[i][j]=ALFABETO[Math.floor(Math.random()*ALFABETO.length)];
          }
        }
      }
    }

    const sopa=$("#sopa"), lista=$("#lista-palabras"), foundCountEl=$("#foundCount");
    function renderSopa(){
      sopa.innerHTML="";
      for(let i=0;i<TAM;i++){
        for(let j=0;j<TAM;j++){
          const d=document.createElement("div");
          d.className="cell"; d.id=`${i}-${j}`; d.textContent=grid[i][j];
          sopa.appendChild(d);
        }
      }
    }
    function mostrarPalabras(){
      lista.innerHTML="";
      PALABRAS.forEach(p=>{
        const s=document.createElement("span");
        s.className="word"; s.id=`palabra-${p.texto}`; s.textContent=p.texto;
        lista.appendChild(s);
      });
    }

    // ===== Popup =====
    const pop=$("#pop"), popWord=$("#popWord"), popMsg=$("#popMsg"), popClose=$("#popClose");
    function showPopup(word,msg){
      popWord.textContent=word; popMsg.textContent=msg;
      pop.classList.add("show"); popClose.focus();
      document.addEventListener("keydown",escHandler);
    }
    function hidePopup(){
      pop.classList.remove("show");
      document.removeEventListener("keydown",escHandler);
    }
    function escHandler(e){ if(e.key==="Escape") hidePopup(); }
    popClose.addEventListener("click",hidePopup);
    pop.addEventListener("click",(e)=>{ if(e.target.dataset.close) hidePopup(); });

    // ===== Selección con "imán" a 8 direcciones =====
    let startCell=null, seleccion=[], seleccionActiva=false, totalEncontradas=0;

    function idToRC(id){ const [r,c]=id.split("-").map(Number); return {r,c}; }
    function clampDir(n){ return n===0?0:(n>0?1:-1); }

    function buildSnappedPath(startId, currentId){
      const {r:rs,c:cs}=idToRC(startId);
      const {r:rc,c:cc}=idToRC(currentId);
      const dx = clampDir(cc - cs);
      const dy = clampDir(rc - rs);
      if(dx===0 && dy===0) return [startId];

      const len = Math.max(Math.abs(cc-cs), Math.abs(rc-rs));
      const path = [];
      for(let i=0;i<=len;i++){
        const r = rs + dy*i;
        const c = cs + dx*i;
        if(r<0||r>=TAM||c<0||c>=TAM) break;
        path.push(`${r}-${c}`);
      }
      return path;
    }

    function paintSelection(ids){
      // limpia
      document.querySelectorAll(".cell.selected").forEach(c=>c.classList.remove("selected"));
      // pinta
      ids.forEach(id=>{
        const el=document.getElementById(id);
        if(el && !el.classList.contains("found")) el.classList.add("selected");
      });
    }

    function verificarSeleccion(){
      if(seleccion.length<2){ paintSelection([]); seleccion=[]; return; }

      const txt = seleccion.map(id=>document.getElementById(id).textContent).join("");
      const txtInv = [...txt].reverse().join("");
      const coordsInv = [...seleccion].reverse();

      const hit = PALABRAS.find(p =>
        seleccion.length===p.coords.length &&
        (txt===p.texto && p.coords.every((c,i)=>c===seleccion[i]) ||
         txtInv===p.texto && p.coords.every((c,i)=>c===coordsInv[i]))
      );

      if(hit){
        hit.coords.forEach(id=>{
          const cell=document.getElementById(id);
          cell.classList.remove("selected"); cell.classList.add("found");
        });
        document.getElementById(`palabra-${hit.texto}`).classList.add("found");
        totalEncontradas++; foundCountEl.textContent=totalEncontradas;
        showPopup(hit.texto, hit.reflexion);
      }
      paintSelection([]); seleccion=[];
    }

    function empezar(e){
      const cell = e.target.closest(".cell");
      if(!cell) return;
      seleccionActiva=true;
      startCell = cell.id;
      seleccion = [startCell];
      paintSelection(seleccion);
    }
    function mover(e){
      if(!seleccionActiva || !startCell) return;
      const cell = e.target.closest(".cell");
      if(!cell) return;
      const path = buildSnappedPath(startCell, cell.id);
      seleccion = path;
      paintSelection(seleccion);
    }
    function fin(){
      if(!seleccionActiva) return;
      seleccionActiva=false;
      verificarSeleccion();
    }

    function startTouch(e){
      e.preventDefault();
      const t=document.elementFromPoint(e.touches[0].clientX,e.touches[0].clientY);
      if(!(t && t.classList.contains("cell"))) return;
      seleccionActiva=true; startCell=t.id; seleccion=[startCell]; paintSelection(seleccion);
    }
    function moveTouch(e){
      e.preventDefault();
      if(!seleccionActiva || !startCell) return;
      const t=document.elementFromPoint(e.touches[0].clientX,e.touches[0].clientY);
      if(!(t && t.classList.contains("cell"))) return;
      const path = buildSnappedPath(startCell, t.id);
      seleccion = path;
      paintSelection(seleccion);
    }

    function eventos(){
      // mouse
      sopa.addEventListener("mousedown", empezar);
      sopa.addEventListener("mousemove", mover);
      document.addEventListener("mouseup", fin);
      // touch
      sopa.addEventListener("touchstart", startTouch, {passive:false});
      sopa.addEventListener("touchmove",  moveTouch,  {passive:false});
      sopa.addEventListener("touchend",   fin);
      sopa.addEventListener("touchcancel",fin);
    }

    // Init
    PALABRAS.forEach(p=>colocarPalabra(p));
    rellenarLetras();
    renderSopa();
    mostrarPalabras();
    eventos();
  </script>
</body>
</html>
